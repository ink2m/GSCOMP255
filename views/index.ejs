<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    <%= title %>
  </title>
  <!-- jQuery script plugin -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">

  <!-- Data Table plugin -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

  <!-- Toast plugin / CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr/build/toastr.min.css">

  <!-- Toast plugin / JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/toastr/build/toastr.min.js"></script>

  <style>
    .error {
      color: rgb(219, 20, 80);
      font-weight: 700;
      display: block;
      padding: 6px 0;
      font-size: 14px;
    }

    .form-control.error {
      border-color: rgb(219, 20, 80);
      padding: .375rem .75rem;
    }
  </style>
</head>

<body>

  <div class="container-fluid mt-3 mb-3">
    <div class="hero bg-info text-white p-4 rounded">
      <h2> Welcome to GS/COMP/255 Car Sale </h2>
      <br>
      <h4>Buy/ Sell your vehicle, any time, anywhere</h4>
    </div>
  </div>

  <div class="container-fluid ">
    <div class="row">
      <!-- Form section -->
      <div class="col-md-5 bg-secondary.bg-gradient text-white p-5 rounded shadow-lg ml-1">
        <h4 class="text-black mt-1 mb-3">Manage Users</h4>
        <!-- Main button initialization -->
        <div id="main_btn">
          <button type="button" onclick="show_add_form()" class="btn btn-success btn-sm">New User</button>
        </div>
        <!-- Main button ending -->

        <!-- Form section initialization -->
        <div id="main_form" style="display: none;">
          <form id="insert_form" role="form" autocomplete="off" method="post">
            <div class="mb-2 mt-2">
              <input type="text" name="txt_for" id="txt_for">
              <input type="hidden" name="txt_order_id" id="txt_order_id">
              <input type="text" id="txt_full_name" name="txt_full_name" class="form-control" placeholder="Full Name">
            </div>
            <div class="mb-2 mt-2">
              <input type="text" id="txt_email" name="txt_email" class="form-control" placeholder="Email">
            </div>
            <div class="mb-2 mt-2">
              <input type="number" id="txt_contact" name="txt_contact" class="form-control"
                placeholder="Contact Number">
            </div>
            <div class="mb-2 mt-2">
              <textarea type="text" id="txt_description" name="txt_description" class="form-control"
                placeholder="Description"></textarea>
            </div>
            <div id="submit_div" class="mb-2 mt-2">
              <button name="Submit" class="btn btn-success">Submit</button>
            </div>
          </form>
        </div>
      </div>
      <!-- Form section ending -->

      <!-- Data Table section -->
      <div class="col-md-7">
        <h4>User Data</h4>
        <div class="table-responsive m-t-40">
          <table id="example23" class="" cellspacing="0" width="100%">

          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- jquery validate plugin -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.21.0/jquery.validate.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>

  <!-- JavaScript section -->
  <script>
    function show_add_form() {
      // Show the form
      $('#main_form').show();
      // Set the value for the hidden field to 'INSERT'
      $('#txt_for').val('INSERT');

      // Create the button content dynamically
      let content = '';
      content += '<button type="button" onclick="hide_form()" class="btn btn-warning">Hide Form</button>';
      content += '<br>';

      // Update the #main_btn element with the new content
      $('#main_btn').html(content);
    }

    function show_edit_form() {
      // Show the form
      $('#main_form').show();
      // Set the value for the hidden field to 'EDIT'
      $('#txt_for').val('EDIT');

      // Create the button content dynamically for hiding the form
      let content = '';
      content += '<button type="button" onclick="hide_form()" class="btn btn-success">Hide Form</button>';
      content += '<br>';

      // Update the #main_btn element with the new content
      $('#main_btn').html(content);

      let content1 = '';
      content1 += '<button type="button" onclick="hide_form()" class="btn btn-warning">Edit Data</button>';
      content1 += '<br>';

      // Update the #submit_div element with the new content
      $('#submit_div').html(content1);
    }

    function hide_form() {
      // Hide the form
      $('#main_form').hide();

      // Reset form fields and hidden fields
      $('#txt_full_name').val('');
      $('#txt_email').val('');
      $('#txt_contact').val('');
      $('#txt_description').val('');

      // Create the button content dynamically
      let content = '';
      content += '<button type="button" onclick="show_add_form()" class="btn btn-success">New User</button>';
      content += '<br>';

      // Update the #main_btn element with the new content
      $('#main_btn').html(content);
    }

    // initiating user data table
    let dt = $('#example23').DataTable({
      "order": [
        [0, "desc"]
      ],
      "processing": true,
      "serverSide": true,
      "initComplete": function (settings, json) {
        $('#example23').show();
      },
      "select": true,
      "bFilter": false,
      "bInfo": false,
      "bPaginate": false,
      "columns": [
        { "data": "user_id", "name": "user_id", "title": "ID" },
        { "data": "fullName", "name": "fullName", "title": "Name" },
        { "data": "email", "name": "email", "title": "Email" },
        { "data": "contact", "name": "contact", "title": "Contact" },
        { "data": "description", "name": "description", "title": "Description" },
        { "data": "inserted_date", "name": "inserted_date", "title": "Created date" },
        {
          "data": "isactive", "name": "isactive", "title": "Status",
          "mRender": function (data) {
            if (data == '1') {
              return '<span class="badge badge-success"> Active </span>';
            }
            if (data == '0') {
              return '<span class="badge badge-dark"> Deactive </span>';
            }
            return 'invalid data'; // if the status is not '0' or '1'
          }
        },
        {
          "data": "isactive", "name": "isactive", "title": "Action",
          "mRender": function (data) {
            return '<button type="button" data-toggle="tooltip" title="Edit User" onclick="getUserData(\'' + data + '\');" class="btn text-success"><i class="fa fa-edit"></i> </button>' + '<button id="edited" type="button" data-toggle="tooltip" title="Delete User" onclick="deleteUserData(\'' + data + '\');" class="btn text-danger"><i class="fa fa-trash"></i></button>'
          }
        }
      ],
      "language": {
        "emptyTable": "No data to show !!!"
      },
      "ajax":
      {
        "type": 'get',
        "url": '/getUsersData',
        "contentType": 'application/json; charset-utf-8',
        "dataType": 'json',
        "dataSrc": ""
      }
    });

    $(document).ready(function () {
      // Initially hide the form
      $('#main_form').hide();
      $('#txt_for').val('INSERT');

      // $('#txt_for').val('');
      $('#txt_full_name').val('');
      $('#txt_email').val('');
      $('#txt_contact').val('');
      $('#txt_description').val('');

      // Form validation
      $("#insert_form").validate({
        ignore: [],
        rules: {
          txt_full_name: {
            required: true
          },
          txt_email: {
            required: true,
            email: true
          },
          txt_contact: {
            required: true,
            number: true,
            minlength: 10,
            maxlength: 10
          },
          txt_description: {
            required: true,
            minlength: 10,
            maxlength: 100
          }
        },
        messages: {
          txt_full_name: 'Full name is required',
          txt_email: {
            required: 'Email is required',
            email: 'Email address is not valid'
          },
          txt_contact: {
            required: 'Contact number is required',
            number: 'Please provide a valid contact number',
            minlength: 'Min length - 10 numbers',
            maxlength: 'Max length - 10 numbers'
          },
          txt_description: 'Description is required / min - 10 char / max - 100 char',
          minlength: 'Min length - 10 characters',
          maxlength: 'Max length - 100 characters'
        },

        submitHandler: function (form) {
          // Form submission
          let formData = new FormData(form);
          // insert form
          if ($('#txt_for').val() === 'INSERT') {
            $.ajax({
              url: '/saveFormData',
              data: $('#insert_form').serializeArray(),
              dataType: 'json',
              method: 'POST',
              processData: true,
              error: function (error) {
                dt.ajax.reload();
                dt.draw();
                console.log(error);
                toastr.error(
                  results.message, // message to show
                  'Error',         // title of the toast
                  {
                    positionClass: 'toast-top-right',  // position of the toast
                    timeOut: 3500,                     // time the toast will stay visible
                    closeButton: true,                 // option to close the toast
                    progressBar: true                 // shows progress bar on toast
                  }
                );
              },

              success: function (results) {
                dt.ajax.reload();
                dt.draw();
                if (results.status == 200) {
                  toastr.success(
                    results.message, // message to show
                    'Success',       // title of the toast
                    {
                      positionClass: 'toast-top-right',  // position of the toast
                      timeOut: 3500,                     // time the toast will stay visible
                      closeButton: true,                 // option to close the toast
                      progressBar: true                 // shows progress bar on toast
                    }
                  );
                }
                if (results.status == 500) {
                  toastr.error(
                    results.message, // message to show
                    'Error',         // title of the toast
                    {
                      positionClass: 'toast-top-right',  // position of the toast
                      timeOut: 3500,                     // time the toast will stay visible
                      closeButton: true,                 // option to close the toast
                      progressBar: true                 // shows progress bar on toast
                    }
                  );
                }
                hide_form();
                $('#txt_full_name').val('');
                $('#txt_email').val('');
                $('#txt_contact').val('');
                $('#txt_description').val('');
              }
            })
          }
          // Insert form end
        }
      });
    });
  </script>

</body>

</html>